$(document).ready( function () {  function colorBox ($el, bg) {  $el.colpick({	colorScheme:'dark',	layout:'rgbhex',	color:'ff8800',	onSubmit:function (hsb,hex,rgb,el) {    var $li = $(el).parent();    var ix = $("#list li").index($li);		$(el).css('background-color', '#'+hex);    myTodo[ix].bg = hex;    localStorage.setItem("myTodo", JSON.stringify(myTodo));		$(el).colpickHide();	}}).css('background-color', '#' + bg);}function searchFilterFnc () {  $(".searchFilter").on("keyup", function () {  $("li").hide();  var searchedText = $('.searchFilter').val();  $("li:contains(" + searchedText + ")").show();  searchCounter();  sortList();  if (searchedText == '') {            counterFnc();    }})}function activeCheck ($el) {  $el.on( "click", function () {      var searchedText = $('.searchFilter').val();      var $li = $(this).parent();      var ix = $("#list li").index($li);      var checked = $(this).find(".checkbox").is(':checked');      myTodo[ix].checked = checked;      $li.toggleClass("check");      localStorage.setItem("myTodo", JSON.stringify(myTodo));      counterFnc();      if (searchedText != '') {            searchCounter();    }      recreateArray();    });  }  function taskEdit () {   $(".li-text").on( "click", function () {      var textToEdit = $(this);      var inputEditText = $(this).prev();       textToEdit.hide();      inputEditText.show();                console.log(inputEditText);      $(inputEditText).on("keypress", function(evt) {        if(evt.which == 13) {          var testo = inputEditText.val();          inputEditText.hide();          textToEdit.text(testo).show();          recreateArray();          evt.stopPropagation();          localStorage.setItem("myTodo", JSON.stringify(myTodo));          console.log(myTodo);        }      });    })  }function searchCounter () {  var searchedText = $('.searchFilter').val();  var counter = $("li:contains(" + searchedText + ")").length;  var n = $( ".checkbox:checked" ).length;  var ntodo = counter - n;  $("#counter").text("Hai " + ntodo + " cose da fare per la ricerca '" + searchedText + "'");}  $(".sortByDate").on("click", function (){    myTodo.sort(function(a,b){      return a.dt > b.dt;          })          $("li").remove();  console.log(myTodo);})  $(".sortByDate").on("click", function () {for (var i = 0; i < myTodo.length; i++) {        $("#todo ul").append("<li class='" + (myTodo[i].checked ? 'check' : '') + "'>" + date + "<div class='color-box'></div><input class='checkbox' type='checkbox' " + (myTodo[i].checked ? 'checked' : ' ' ) + " /><span class='li-text'>" + myTodo[i].text + "</span><span class='remove'>X</span></li>");        activeCheck($("#todo ul li").last().find(".checkbox"));        colorBox($("#todo ul li").last().find(".color-box"), myTodo[i].bg);        datePick($("#todo ul li").last().find(".datepicker").val(myTodo[i].dt));        sortList();        taskRemove();  }  recreateArray();  });    function removeAll () {    $(".removeAll").on("click", function (){      $("li").remove();      counterFnc();      recreateArray();    })  }  removeAll();function datePick ($el, dt) {  $el.datepicker({    minDate: 'today',    dateFormat: 'dd M',    onSelect:function () {    recreateArray();    }  })}function sortList() {    $('#list').sortable({        start: function(event, ui) {            var start_pos = ui.item.index();            ui.item.data('start_pos', start_pos);        },        update: function(event, ui) {            var start_pos = ui.item.data('start_pos');            var end_pos = ui.item.index();            recreateArray();        }    });};function recreateArray () {  myTodo = [];  $("#todo ul li").each(function () {    myTodo.push({ text: $(this).find('.li-text').text(), checked: $(".checkbox", this).is(":checked"), bg: $(this).find(".color-box").css("background-color"), dt: $(this).find(".datepicker").val()  });    });    localStorage.setItem("myTodo", JSON.stringify(myTodo));}  function taskRemove () {    $(".remove").on( "click", function () {      var $li = $(this).parent();      var ix = $("#list li").index($li);      myTodo.splice(ix, 1);      $li.remove();      recreateArray();      counterFnc();      var searchedText = $('.searchFilter').val();      if (searchedText != '') {            searchCounter();      }    });  };  function counterFnc () {    var counter = +$("#list li").length;    var n = +$( ".checkbox:checked" ).length;    var ntodo = counter - n;    $("#counter").text("Hai " + ntodo + " cose da fare");  }var date = "<div class='datepick'><input type='text' class='datepicker' /></div>";  $("#todoinput").on("keypress", function(evt) {    if(evt.which == 13) {      var testo = $("#todoinput").val();      var boxcolor = "<div class='color-box'></div>";        var task = "<li>" + date + boxcolor + "<input class='checkbox' type='checkbox' /><input id='taskEdit' type='text'/><span class='li-text'>" + testo + "</span><span class='remove'>X</span></li>";      myTodo.push({ checked: false, text: testo, bg: 'fff' });      console.log(myTodo);      console.log(myTodo.length);      if (testo) {        $("#todo ul").append(task);      }      activeCheck($("#todo ul li").last().find(".checkbox"));      counterFnc();      sortList();      taskEdit();      colorBox($("#todo ul li").last().find(".color-box"), 'fff');      datePick($("#todo ul li").last().find(".datepicker"));      var todayDate = $("#todo ul li").last().find(".datepicker").datepicker("setDate", "today");      $("#todoinput").val('');      evt.stopPropagation();}    taskRemove();    localStorage.setItem("myTodo", JSON.stringify(myTodo));  });  $("#todoinput").on("keyup", function (evt) {    if(evt.which == 13) {      recreateArray();      console.log(myTodo);    }  });var myTodo = [];  function restore() {    var status = localStorage.getItem("myTodo");    if (status) {      myTodo = JSON.parse(status);    }    for (var i = 0; i < myTodo.length; i++) {      var boxcolor = "<div class='color-box'></div>";      $("#todo ul").append("<li class='" + (myTodo[i].checked ? 'check' : '') + "'>" + date + boxcolor + "<input class='checkbox' type='checkbox' " + (myTodo[i].checked ? 'checked' : ' ' ) + " /><input id='taskEdit' type='text'/><span class='li-text'>" + myTodo[i].text + "</span><span class='remove'>X</span></li>");      activeCheck($("#todo ul li").last().find(".checkbox"));      colorBox($("#todo ul li").last().find(".color-box"), myTodo[i].bg);      datePick($("#todo ul li").last().find(".datepicker").val(myTodo[i].dt));      sortList();  }} restore();  console.log(myTodo.length);  console.log(myTodo);  counterFnc();  taskRemove();  searchFilterFnc();  taskEdit();});